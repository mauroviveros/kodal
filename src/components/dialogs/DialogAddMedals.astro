---
import { Button, Dialog, Input } from '@components/ui';
import { Icon } from 'astro-icon/components';
---

<Button id="dialog-add-medals-btn">
  <Icon name="lucide:plus" class="size-4" />
  Crear medallas
</Button>

<Dialog
  title="Crear Medallas Nuevas"
  description="Especifica la cantidad de medallas que deseas crear (mÃ¡ximo 100)"
  id="dialog-add-medals"
  closedby="any"
>
  <form id="dialog-add-medals-form" class="space-y-2">
    <Input type="number" name="quantity" label="Cantidad de Medallas" min="1" max="100" value="1" required />

    <Button type="submit" size="lg" class="w-full"> Crear medallas </Button>
  </form>
</Dialog>

<script>
  import { actions } from 'astro:actions';

  const dialog = document.getElementById('dialog-add-medals') as HTMLDialogElement;
  const form = document.getElementById('dialog-add-medals-form') as HTMLFormElement;
  const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const quantity = parseInt(form.quantity.value);

    submitBtn.disabled = true;
    submitBtn.innerText = 'Creando...';

    try {
      const result = await actions.createBulkMedals({ quantity });
      if (result.error) throw result.error;

      if (result.data.medals) {
        dialog.close();
        window.location.reload();
      }
    } catch (error) {
      console.error('Error creating medals:', error);
      submitBtn.disabled = false;
      submitBtn.innerText = 'Crear medallas';
    }
  });
</script>
