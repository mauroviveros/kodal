---
import { Icon } from 'astro-icon/components';
const dialog_id = `dialog-add-slots`;
---

<button id={`${dialog_id}-btn`} type="button" class="btn btn-filled btn-md">
  <Icon name="lucide:plus" class="size-4" />
  Crear slots
</button>

<dialog id={dialog_id} closedby="any">
  <header class="dialog-header">
    <h2 class="dialog-title">Crear Medallas Nuevas</h2>
    <p class="dialog-description">
      Especifica la cantidad de medallas que deseas crear (m√°ximo 100)
    </p>
  </header>

  <form id={`${dialog_id}-form`} class="dialog-content">
    <fieldset>
      <label for="quantity" class="text-sm">Cantidad</label>
      <input
        type="number"
        name="quantity"
        value="1"
        min="1"
        max="100"
        class="input w-full"
        required
      />
    </fieldset>

    <button type="submit" class="btn btn-lg btn-filled">Crear medallas</button>
  </form>
</dialog>

<script define:vars={{ dialog_id }}>
  const dialog = document.getElementById(dialog_id);
  const openBtn = document.getElementById(`${dialog_id}-btn`);
  const form = document.getElementById(`${dialog_id}-form`);

  openBtn.addEventListener('click', () => {
    dialog.showModal();
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    form.querySelector('button[type="submit"]').disabled = true;
    form.querySelector('button[type="submit"]').innerText = 'Creando...';

    const response = await fetch('/api/slots/bulk', {
      method: 'POST',
      body: new FormData(form),
    });

    if (response.ok) {
      dialog.close();
      window.location.reload();
    }
  });
</script>
