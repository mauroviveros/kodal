---
import Layout from '@layout';
import type { Slot, SlotPaginationResponse } from '@types';
import { Icon } from 'astro-icon/components';

enum Status {
  ACTIVE = 'Activo',
  INACTIVE = 'Inactivo',
}

const response = await fetch(new URL(`/api/slots/${Astro.params.page}`, Astro.request.url));
const { data }: SlotPaginationResponse = await response.json();

const getStatus = (slot: Slot): Status => {
  return slot.medal_id ? Status.ACTIVE : Status.INACTIVE;
};

const getDate = (date: string): string => {
  return Intl.DateTimeFormat(undefined, { dateStyle: 'short', timeStyle: 'short' }).format(
    new Date(date),
  );
};
---

<Layout container>
  <section class="card">
    <article class="card-content flex justify-end">
      <button class="btn btn-filled btn-md">
        <Icon name="lucide:plus" class="size-4" />
        Crear slots
      </button>
    </article>
  </section>

  <section class="card">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha Creacion</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        {
          data.map((slot) => (
            <tr>
              <td>{slot.id}</td>
              <td>{getDate(slot.created_at)}</td>
              <td>
                <span class="badge">
                  <Icon name="lucide:sparkles" />
                  NUEVO
                </span>
              </td>
              <td>
                <div class="flex items-center justify-end gap-2">
                  <button id={`view-${slot.id}`} type="button" class="btn btn-sm">
                    <Icon name="lucide:eye" class="size-4" />
                  </button>
                  <button id={`qr-${slot.id}`} type="button" class="btn btn-sm">
                    <Icon name="lucide:qr-code" class="size-4" />
                  </button>
                </div>
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </section>

  <dialog id="dialog" closedby="any">
    <p>Greetings, one and all!</p>
    <form method="dialog">
      <button>OK</button>
    </form>
  </dialog>
</Layout>

<script>
  const dialog = document.getElementById('dialog') as HTMLDialogElement;

  document.querySelectorAll('button').forEach((button) => {
    button.addEventListener('click', () => {
      dialog.showModal();
    });
  });
</script>
