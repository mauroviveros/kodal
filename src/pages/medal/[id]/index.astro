---
import Layout from '@layout';
import { BasicCard, PromoCard } from '@components/cards';
import { supabase } from '@lib/supabase';

if (!Astro.params.id) return Astro.redirect('/404');

const { data: slot } = await supabase
  .from('medals_slot')
  .select('*')
  .eq('id', Astro.params.id)
  .single();

if (!slot) return Astro.rewrite('/404');
if (!slot.medal_id) return Astro.redirect(`/medal/${slot.id}/edit`);

const { data: medal } = await supabase
  .from('medals')
  .select('*')
  .eq('id', slot.medal_id)
  .maybeSingle();

if (!medal) return Astro.rewrite('/404');
---

<Layout container>
  <BasicCard medal={medal} />
  <PromoCard />
</Layout>
