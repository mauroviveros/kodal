---
import Layout from '@layout';
import { db, eq, Pet as Table } from 'astro:db';
import { BasicCard, ContactCard, PromoCard } from '@components/cards';
import type { Pet } from '@types';

if (!Astro.params.id) return Astro.redirect('/404');
const pet = (await db.select().from(Table).where(eq(Table.id, Astro.params.id)).get()) as Pet;
if (!pet) return Astro.rewrite('/404');
if (!pet.name) return Astro.redirect(`${Astro.url}/edit`);
---

<Layout container>
  <BasicCard pet={pet} />
  <ContactCard pet={pet} />
  <PromoCard />
</Layout>
