---
import { BasicForm } from '@components/forms';
import Layout from '@layout';
import { getSlotDetails } from '@lib/services/slots';
import { createClient } from '@lib/supabase';
import { Icon } from 'astro-icon/components';

if (!Astro.params.slot_id) return Astro.rewrite('/404');
const { slot, medal } = await getSlotDetails(Astro.locals.supabase)(Astro.params.slot_id);
if (!slot) return Astro.rewrite('/404');
---

<Layout class="max-w-2xl">
  <hgroup class="mb-6 flex flex-col gap-2">
    <h1 class="text-3xl font-bold">
      {
        slot.medal_id ? (
          <>
            Editar información de <span class="text-primary">{medal?.name}</span>
          </>
        ) : (
          'Crear información de tu mascota'
        )
      }
    </h1>
    <p class="text-on-muted">
      {
        slot.medal_id
          ? 'Actualiza los datos de tu mascota para mantener su perfil al día.'
          : 'Completa los datos de tu mascota para crear su perfil.'
      }
    </p>
  </hgroup>

  <form action={`/api/slot/${slot.id}/medal`} method="POST" class="flex flex-col gap-6">
    <BasicForm medal={medal} />

    <div class="flex gap-4">
      {
        slot.medal_id && (
          <a href={`/medal/${medal?.id}`} class="btn btn-lg btn-outline flex-1">
            Cancelar
          </a>
        )
      }

      <button type="submit" class="btn btn-lg btn-filled flex-1">
        <Icon name="lucide:save" />
        {slot.medal_id ? 'Guardar' : 'Crear'}
      </button>
    </div>
  </form>
</Layout>
